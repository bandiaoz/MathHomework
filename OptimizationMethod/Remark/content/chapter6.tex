\section{非线性规划的最优性条件}
\subsection{无约束优化的最优性条件}
无约束优化问题
\[
    \begin{cases}
        \min \quad &f(x)\\
        \subject \quad &x \in E^n
    \end{cases}
\]
\begin{definition}[下降方向]
    设 $\bar{x} \in E^n$ 是任给一点，$d\neq 0$ ，若存在 $\delta > 0$，使得对任意的 $\lambda \in (0, \delta)$，有 $f(\bar{x} + \lambda d) < f(\bar{x})$，则称 $d$ 为 $f(x)$ 在点 $\bar{x}$ 处的下降方向。
\end{definition}

\begin{theorem}
    设函数 $f(x)$ 在点 $\bar{x}$ 可微，若存在 $d \neq 0$ 使 $\nabla f(\bar{x})^td < 0$，则存在 $\delta > 0$，使对 $\forall \lambda\in (0, \delta)$，有 $f(\bar{x} + \lambda d) < f(\bar{x})$，即 $d$ 是下降方向。
\end{theorem}

\begin{theorem}
    无约束优化问题的最优性条件\begin{itemize}
        \item 一阶必要条件：设函数 $f(x)$ 在点 $\bar{x}$ 处可微，若 $\bar{x}$ 是局部极小点，则 $\nabla f(\bar{x}) = 0$。
        \item 二阶必要条件：设函数 $f(x)$ 在 $\bar{x}$ 处二阶可微，若 $\bar{x}$ 是局部极小点，则 $\nabla f(\bar{x}) = 0$，且 $\nabla^2f(\bar{x})$ 是半正定的。
        \item 充分条件：设函数 $f(x)$ 在点 $\bar{x}$ 处二次可微，若 $\nabla f(\bar{x}) = 0$，且 $\nabla^2f(\bar{x})$ 正定，则 $\bar{x}$ 是严格局部极小点。
        \item 设函数 $f(x)$ 在点 $\bar{x}$ 的邻域内二次可微，若 $\nabla f(\bar{x}) = 0$，且 $\nabla^2f(x)$ \textbf{在该邻域内}半正定，则 $\bar{x}$ 是局部极小点。特别地，对于邻域内的任意点 $x\neq \bar{x}$，若 $\nabla^2f(x)$ 正定，则 $\bar{x}$ 是一个\textbf{严格}的局部极小点。
        \item 设 $f(x)$ 是定义在 $E^n$ 上的可微凸函数，$\bar{x} \in E^n$，则 $\bar{x}$ 为整体极小点的充要条件是 $\nabla f(\bar{x}) = 0$。
    \end{itemize}
\end{theorem}

\begin{example}
    求 $f(x) = (x_1 - 2)^4 + (x_1 - 2x_2)^2$ 的极小点。

    \answer
    \[
        \nabla f(x) = \begin{pmatrix}
            4(x_1 - 2)^3 + 2(x_1 - 2x_2)\\
            -4(x_1 - 2x_2)
        \end{pmatrix}    
    \]
    令 $\nabla f(x) = 0$，解得驻点 $x^* = (2, 1)^t$。
    \[
        \nabla^2 f(x) = \begin{pmatrix}
            12(x_1 - 2)^2 + 2 & -4\\
            -4 & 8
        \end{pmatrix}    
    \]
    $\nabla^2 f(x)$ 在 $x^*$ 邻域内半正定，故 $x^* = (2, 1)^t$ 是局部极小点。
\end{example}

\begin{note}
    驻点\begin{itemize}
        \item 定义：若 $f(x)$ 在点 $x^*$ 可微，并且 $\nabla f(x^*) = 0$.则 $x^*$ 称为 $f(x)$ 的一个驻点(平稳点)，既不是极小点，也不是极大点的驻点称为鞍点.
    \end{itemize}
\end{note}

\subsection{约束优化问题的最优性条件}
\begin{definition}[下降方向]
    对 $\underset{x \in E^n}{\min}f(x)$，设 $\bar{x} \in E^n$ 是任给一点，$d\neq 0$，若存在 $\delta > 0$，使得对任意的 $\lambda \in (0, \delta)$ 有 $f(\bar{x} + \lambda d) < f(\bar{x})$，则称 $d$ 为 $f(x)$ 在点 $\bar{x}$ 处的下降方向。
    \[
        F_0 = \{d \mid \nabla f(\bar{x})^td < 0\}
    \]
    称为点 $\bar{x}$ 处的\textbf{下降方向集}。
\end{definition}

\begin{definition}[可行方向]
    设集合 $S \subset E^n$，$\bar{x} \in clS$，$d$ 为非零向量，若存在数 $\delta > 0$，使得对任意 $\lambda \in (0, \delta)$，都有 $\bar{x} + \lambda d \in S$ 则称 $d$ 为集合 $S$ 在 $\bar{x}$ 的\textbf{可行方向}。
    \[
        D = \{d \mid d \neq 0, \bar{x} \in clS, \exists \delta>0, \forall \lambda \in(0, \delta), \bar{x}+\lambda d \in S\}
    \] 
    是 $\bar{x}$ 处的\textbf{可行方向锥}。
\end{definition}

\begin{theorem}[几何最优性条件]
    考虑问题
    \[
        \begin{cases}
            \min \quad &f(x)\\
            \subject \quad &x \in S
        \end{cases}    
    \]
    设 $S$ 是 $E^n$ 的非空集合，$\bar{x} \in S$，$f(x)$ 在 $\bar{x}$ 处可微，若 $\bar{x}$ 是局部最优解，则下降方向集和可行方向锥没有交集. 即 $F_0\cap D = \varnothing$。
\end{theorem}

\begin{theorem}
    不等式约束优化问题的一阶最优性条件
    \[
        \begin{cases}
            \min \quad &f(x)\\
            \subject \quad &g_i(x) \ge 0, \quad i = 1, \dots, m
        \end{cases}
    \]
    可行域 $S = \left\{x \mid g_i(x) \ge 0, i = 1, \dots, m\right\}$
    \begin{itemize}
        \item 记 $I = \left\{i \mid g_i(\bar{x}) = 0, \bar{x} \in S\right\}$ 为起作用约束(等式约束)。
        \item $G_0 = \left\{d \mid \nabla g_i(\bar{x})^td > 0, i \in I\right\}$ 称为 $S$ 在点 $\bar{x}$ 处的\textbf{局部约束方向锥(内方向锥)}。
        \item 几何最优性条件：设 $\bar{x} \in S$，$f(x)$ 和 $g_i(x)(i \in I)$ 在 $\bar{x}$ 处可微，$g_i(x)(i \notin I)$ 在 $\bar{x}$ 处连续，如果 $\bar{x}$ 是局部最优解，则下降方向集和内方向锥的交集为空，即 $F_0\cap G_0 = \varnothing$。
    \end{itemize}
\end{theorem}

\begin{theorem}
    Fritz John 条件：设 $\bar{x} \in S$， $f(x), g_i(x)(i \in I)$ 在 $\bar{x}$ 处可微，$g_i(x)(i\notin I)$ 在 $\bar{x}$ 处连续，若 $\bar{x}$ 是局部最优解，则存在不全为零的数 $w_0, w_i(i \in I)$，使得 
    \[
        \begin{cases}
            w_{0} \nabla f(\bar{x})-\sum_{i \in I} w_{i} \nabla g_{i}(\bar{x})=0 \\
            w_{0}, w_{i} \geq 0, \quad i \in I
        \end{cases}
    \] 
    $\bar{x}$ 称为 Fritz John 点，即满足Fritz John条件的点.
\end{theorem}

\begin{theorem}
    KKT 条件：设 $\bar{x} \in S$， $f(x), g_i(x)(i \in I)$ 在 $\bar{x}$ 处可微，$g_i(x)(i\notin I)$ 在 $\bar{x}$ 处连续，若 $\bar{x}$ 是局部最优解，存在非负数 $w_i, i \in I$，使得\[\nabla f(\bar{x}) - \sum_{i \in I}w_i\nabla g_i(\bar{x}) = 0\]
    
    设 $\bar{x} \in S, f, g_i$ 在 $\bar{x}$ 可微，$\left\{\nabla g_i(\bar{x}) \mid i \in I\right\}$；线性无关，若 $\bar{x}$ 是局部最优解，则存在数 $w_i, i=1, 2, \dots, m$，使得
    \[
        \begin{cases}
            \nabla f(\bar{x})-\sum_{\mathrm{i}=1}^{m} w_{i} \nabla g_{i}(\bar{x})=0 \\
            w_{i} g_{i}(\bar{x})=0 \quad i=1,2, \cdots, m \\
            w_{i} \geq 0 \quad i=1,2, \cdots, m 
        \end{cases}
    \]

    对于凸规划，则若在 $\bar{x}$ 点处KKT条件成立，则 $\bar{x}$ 为整体极小值点.
\end{theorem}

\subsection{一般约束问题的一阶最优性条件}
\begin{theorem}
    设 $\bar{x} \in S$，$f(x)$ 和 $g_i(x)(i\in I)$ 在 $\bar{x}$ 处可微，$g_i(x) (i \notin I)$ 在 $\bar{x}$ 处连续，$h_j(j = 1, \dots, l)$ 在 $\bar{x}$ 处连续可微，且 $\bar{x}$ 是 $\S = \{x \mid h(x) = 0\}$ 的正则点.如果 $\bar{x}$ 是问题(NP)的局部最优解，则在 $\bar{x}$ 处，有\[F_{0} \cap G_{0} \cap H_{0}=\varnothing\]其中
    \begin{align*}
        F_{0}&=\left\{d \mid \nabla f(\bar{x})^{T} d<0\right\} \\
        G_{0}&=\left\{d \mid \nabla g_{i}(\bar{x})^{T} d>0, i \in I\right\} \\
        H_{0}&=\left\{d \mid \nabla h_{j}(\bar{x})^{T} d=0, j=1, \cdots, l\right\}
    \end{align*}
\end{theorem}

\begin{theorem}
    若系统 $Ax < 0$，$Bx = 0$ 无解，则系统 $A^ty + B^tz = 0, y \ge 0$，且 $y \neq 0$ 或 $z \neq 0$ 有解.
\end{theorem}

\begin{note}
    一阶充分条件(凸优化问题)：\[\begin{cases}
        \min &f(x)\\
        \subject &g_i(x) \ge 0 \quad i = 1, \dots, m\\
        &h_j(x) = 0, \quad j = 1, \dots, l
    \end{cases}\]
    $f$ 是凸函数，$g_i$ 是凹函数，$h_j$ 是线性函数，$S$ 为可行域，$\bar{x} \in S$，$I = \{i \mid g_i(\bar{x}) = 0\}$. $f$ 和 $g_i(i \in I)$ 在点 $\bar{x}$ 可微，$h_j$ 在点 $\bar{x}$ 连续，$g_i(i \notin I)$ 在点 $\bar{x}$ 连续，且在 $\bar{x}$ 处 KKT 条件成立，则 $\bar{x}$ 为整体极小点.
\end{note}

\subsection{约束优化问题的二阶最优性条件}
\begin{theorem}[二阶充分条件]
    对于优化问题
    \[
        \begin{cases}
            \min \quad &f(x) \\
            \subject \quad &g_i(x) \ge 0\\
            &h_j(x) = 0
        \end{cases}    
    \]
    设 $f, g_i, h_j$ 是二次连续可微函数，$\bar{x}$ 为可行解，若存在 $\bar{w}, \bar{v}$，使 $(\bar{x}, \bar{w}, \bar{v})$ 满足KKT条件且矩阵 $\nabla^2_xL(\bar{x}, \bar{w}, \bar{v})$ 在子空间 G 上是正定的，则 $\bar{x}$ 是严格局部极小点。其中
    \[
        G = \left\{
            d \neq 0 \left|
            \begin{matrix}
                \nabla g_i(\bar{x})^td = 0, i \in I(\bar{x}) \qand \bar{w}_i > 0\\
                \nabla g_i(\bar{x})^td \ge 0, i \in I(\bar{x}) \qand \bar{w}_i = 0\\
                \nabla h_j(\bar{x})^td = 0    
            \end{matrix}\right.
        \right\}
    \]
\end{theorem}

\begin{example}
    求解如下问题的局部最优解
    \[
        \begin{cases}
            \min \quad &f(x) = x_1x_2\\
            \subject \quad &c(x) = x_1^2 + x_2^2 - 1 = 0
        \end{cases}    
    \]

    \answer 拉格朗日函数 $L(x, \mu) = x_1x_2 + \mu(x_1^2 + x_2^2 - 1)$

    有KKT条件
    \[
        \begin{cases}
            x_1^2 + x_2^2 - 1 = 0\\
            x_2 + 2\mu x_1 = 0\\
            x_1 + 2\mu x_2 = 0
        \end{cases}    
    \]
    解得 
    \[
        \mu = -\frac{1}{2}, x^* = \left(\frac{\sqrt{2}}{2}, \frac{\sqrt{2}}{2}\right)^t \qor x^* = \left(-\frac{\sqrt{2}}{2}, -\frac{\sqrt{2}}{2}\right)^t
    \]
    或
    \[
        \mu = \frac{1}{2}, x^* = \left(-\frac{\sqrt{2}}{2}, \frac{\sqrt{2}}{2}\right)^t \qor x^* = \left(\frac{\sqrt{2}}{2}, -\frac{\sqrt{2}}{2}\right)^t
    \]

    根据二阶条件，第一种情况
    \[
        \nabla^2L_x = \begin{pmatrix}
            2\mu & 1\\
            1 & 2\mu
        \end{pmatrix} = \begin{pmatrix}
            -1 & 1\\
            1 & -1
        \end{pmatrix}
    \]
    $\mu = -\frac{1}{2}$，对任意的 $d\neq 0$，满足 $d_1 = -d_2$，故
    \[
        d^t\nabla^2_xLd = -4d_1^2 < 0
    \]
    故 $x^* = \left(\frac{\sqrt{2}}{2}, \frac{\sqrt{2}}{2}\right)^t \qor x^* = \left(-\frac{\sqrt{2}}{2}, -\frac{\sqrt{2}}{2}\right)^t$ 是局部极大值点。

    第二种情况
    \[
        \nabla^2L_x = \begin{pmatrix}
            2\mu & 1\\
            1 & 2\mu
        \end{pmatrix} = \begin{pmatrix}
            1 & 1\\
            1 & 1
        \end{pmatrix}
    \]
    $\mu = \frac{1}{2}$，对任意的 $d\neq 0$，满足 $d_1 = d_2$，故
    \[
        d^t\nabla^2_xLd = 4d_1^2 > 0
    \]
    故 $x^* = \left(-\frac{\sqrt{2}}{2}, \frac{\sqrt{2}}{2}\right)^t \qor x^* = \left(\frac{\sqrt{2}}{2}, -\frac{\sqrt{2}}{2}\right)^t$ 是局部极小值点。
\end{example}